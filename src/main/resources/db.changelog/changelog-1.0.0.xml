<?xml version="1.0"?>
<databaseChangeLog xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog">
    <changeSet id="create_table_news" author="v.petukhov">
        <createTable tableName="news">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="title" type="VARCHAR(255)"/>
            <column name="anons" type="VARCHAR(255)"/>
            <column name="full_text" type="VARCHAR(1380)"/>
            <column name="views" type="INT(11)"/>
            <column defaultValueComputed="NOW()" name="time" type="DATETIME WITH TIMEZONE(19)"/>
        </createTable>
    </changeSet>
    <changeSet id="createNewsItem" author="v.petukhov">
        <insert tableName="news">
            <column name="title" value="Главная новость"/>
            <column name="anons" value="Египет будет платить деньги за российских туристов, прилетающих в Хургаду и Шарм-эль-Шейх"/>
            <column name="full_text" value="За каждого привезенного туриста на курорты Египта - в аэропорт Хургады или Шарм-эль-Шейха, египетское правительство будет выплачивать субсидии туроператорам, организовавшим соответствующий чартер. Программа запускается явно под открытие Россией прямых рейсов на курорты Египта, и нацелена на стимуляцию продаж для увеличения турпотока. Субсидии будут выплачиваться в период с мая по 31 октября 2021 года для рейсов, прилетающих в любой из 9 аэропортов Египта."/>
            <column name="views" value="0"/>
        </insert>
    </changeSet>
    <changeSet id="addColumnStr" author="v.petukhov">
        <addColumn tableName="news">
            <column name="str" type="VARCHAR(16)"/>
        </addColumn>
    </changeSet>
    <changeSet id="createTableRoles" author="v.petukhov">
        <createTable tableName="roles">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(64)"/>
        </createTable>
    </changeSet>
    <changeSet id="createTablePersons" author="v.petukhov">
        <createTable tableName="persons">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="first_name" type="VARCHAR(64)"/>
            <column name="last_name" type="VARCHAR(64)"/>
            <column name="password" type="VARCHAR(64)"/>
            <column name="login" type="VARCHAR(64)"/>
            <column name="email" type="VARCHAR(64)"/>
            <column name="role_id" type="UUID"/>
        </createTable>
    </changeSet>
    <changeSet id="addRoleSuperAdmin" author="v.petukhov">
        <insert tableName="roles">
            <column name="id" value="af052be0-7fe6-4731-8e64-fa5c3f559ce9"/>
            <column name="name" value="SUPER-ADMIN"/>
        </insert>
    </changeSet>
    <changeSet id="addPerson" author="v.petukhov">
        <insert tableName="persons">
            <column name="first_name" value="Jack"/>
            <column name="last_name" value="Daniels"/>
            <column name="password" value="superadmin"/>
            <column name="login" value="superadmin"/>
            <column name="email" value="jack@mail.ru"/>
            <column name="role_id" value="af052be0-7fe6-4731-8e64-fa5c3f559ce9"/>
        </insert>
    </changeSet>
    <changeSet id="updateTablePersons" author="v.petukhov">
        <sql>
            update persons set password = '{noop}superadmin' where id = 1;
        </sql>
    </changeSet>
    <changeSet id="updateTableRoles" author="v.petukhov">
        <sql>
            update roles set name = 'ROLE_SUPER-ADMIN' where id='af052be0-7fe6-4731-8e64-fa5c3f559ce9';
        </sql>
    </changeSet>
    <changeSet id="addRoleADMIN" author="v.petukhov">
        <insert tableName="roles">
            <column name="id" value="e054c836-bc51-45b6-9ca9-1b868c780b98"/>
            <column name="name" value="ROLE_ADMIN"/>
        </insert>
    </changeSet>
    <changeSet id="addRoleUser" author="v.petukhov">
        <insert tableName="roles">
            <column name="id" value="033bde84-db3c-48d4-982e-cd9b2e661ac1"/>
            <column name="name" value="ROLE_USER"/>
        </insert>
    </changeSet>
    <changeSet id="addColumnPerson_idToNews" author="v.petukhov">
        <addColumn tableName="news">
            <column name="person_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet id="updateColumnFullTextInTableNews" author="v.petukhov">
        <sql>
            alter table news alter column full_text type varchar(5000);
        </sql>
    </changeSet>
    <changeSet id="addTableComments" author="v.petukhov">
        <sql>
            create table comments (id serial, text varchar(510),
            news_item_id BIGINT REFERENCES news (id), person_id BIGINT REFERENCES persons(id));
        </sql>
    </changeSet>
    <changeSet id="addPrimaryKeyTableComments" author="v.petukhov">
        <sql>
            alter table comments add primary key(id);
        </sql>
    </changeSet>
    <changeSet id="addColumnTimeToComments" author="v.petukhov">
        <addColumn tableName="comments">
            <column defaultValueComputed="NOW()" name="time" type="DATETIME WITH TIMEZONE(19)"/>
        </addColumn>
    </changeSet>
    <changeSet id="addColumnUrlImage" author="v.petukhov">
        <addColumn tableName="news">
            <column name="url_image" type="VARCHAR(1024)" />
        </addColumn>
    </changeSet>
</databaseChangeLog>